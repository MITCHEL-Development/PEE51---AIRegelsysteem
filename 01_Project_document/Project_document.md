# Neuraal netwerk ter vervanging van een PID-regelaar

Voor dit project waren er drie belangrijke onderdelen. Ten eerste moest de FRDM-MCXN947 microcontroller worden verbonden met een pingpongopstelling, waarmee de hoogte van een pingpongbal gereguleerd wordt. Ten tweede moest er een neuraal netwerk worden getraind dat het gedrag van een PID-regelaar nauwkeurig kon nabootsen. Tot slot moest het getrainde netwerk worden geïmplementeerd op de FRDM-MCXN947 microcontroller, zodat het in real-time ingezet kon worden voor aansturing.

Gedurende het project waren er verschillende beperkingen waarmee we rekening moesten houden. Zo was het verplicht om gebruik te maken van de FRDM-MCXN947 microcontroller. Dit vereiste dat het neuraal netwerk aangepast werd aan de beperkingen en mogelijkheden van deze specifieke hardware. Daarnaast moest het netwerk specifiek het gedrag van een PID-regelaar imiteren, wat een nauwkeurige afstemming van de trainingsdata en het model noodzakelijk maakte. Een extra uitdaging was dat we bij aanvang van het project weinig tot geen ervaring hadden met neurale netwerken, noch met de praktische implementatie ervan op embedded systemen. Dit betekende dat er eerst een flinke leerfase nodig was, waarin we theoretische en praktische kennis moesten opdoen.

## Sprint 0 & 1

Bij de start van het project zijn we begonnen met het opstellen van het projectplan en het kiezen van een geschikte werkwijze. In deze fase hebben we ook een plan van aanpak opgesteld, waarin de globale fasering, doelstellingen en aanpak van het project zijn vastgelegd. We kozen voor de Scrum-methode, omdat deze goed aansluit bij de iteratieve aard van het project. Door te werken in korte sprints konden we telkens een onderdeel van het systeem ontwikkelen, testen en bijstellen. In Sprint 0 is ook de taakverdeling gemaakt, zodat ieder teamlid verantwoordelijkheid kreeg over een specifiek deel van het project. Daarnaast zijn via het projectmanagementprogramma Notion een aantal taken toegewezen. Hiermee kreeg het project een gestructureerde vorm.

Vanuit zowel de bedrijfsbegeleider als de schoolbegeleider kregen we het advies om direct aan de slag te gaan met de FRDM-MCXN947 microcontroller. Dit was gebaseerd op ervaringen uit eerdere projecten, waaruit bleek dat vroege implementatie van de hardware veel problemen in latere fases kon voorkomen. Ondanks dit advies hebben we ervoor gekozen om het project op te splitsen in twee hoofddelen: enerzijds de implementatie van de hardware en anderzijds het opzetten van een neuraal netwerk.

Voor het implementatiedeel was het doel om de pingpongopstelling uit de DIS10-cursus, die oorspronkelijk met een andere microcontroller werd aangestuurd, na te bootsen met de FRDM-MCXN947. Hiervoor moest de communicatie tussen de microcontroller en de hardware correct worden opgezet, en moest de aansturing zodanig gebeuren dat de bal stabiel op een gewenste hoogte kon worden gehouden.

Het tweede hoofddoel richtte zich op het trainen van een neuraal netwerk. Hierbij was de insteek om te beginnen met een eenvoudig voorbeeldnetwerk, zodat we ervaring konden opdoen met het opzetten, trainen en evalueren van een neuraal netwerk. In deze fase hebben we diverse bronnen geraadpleegd, waaronder online cursussen en documentatie, om een goed begrip te krijgen van hoe neurale netwerken werken en hoe deze praktisch te implementeren zijn.


## Sprint 2

Voor deze sprint zijn we bezig geweest met het PID intergreren in de microcontroller (FRDM-MCXN947) en het maken van een aantal eisen en wensen. De eisen en wensen zijn opgesteld om een duidelijk kader te scheppen voor de functionaliteit van het systeem. De eisen waren gericht op de technische specificaties, zoals de nauwkeurigheid van de hoogtebepaling van de pingpongbal, de responstijd van het systeem en de stabiliteit van de aansturing. De wensen omvatten meer algemene aspecten, zoals gebruiksvriendelijkheid en uitbreidbaarheid van het systeem. in deze sprint zijn we ook bezig geweest met het onderzoeken hoe een neuraal netwerk werkt en hoe we dit kunnen toepassen in ons project. We hebben verschillende bronnen geraadpleegd, waaronder online cursussen en documentatie, om een goed begrip te krijgen van de werking van neurale netwerken en hoe deze praktisch te implementeren zijn. Daarnaast hebben we een aantal experimenten uitgevoerd met eenvoudige netwerken in Python, gebruikmakend van TensorFlow en PyTorch. Deze experimenten hielpen ons om vertrouwd te raken met de architectuur, activatiefuncties en het trainingsproces van neurale netwerken.

Voor het trainen van een neuraal netwerk is er eerst gebruik gemaakt van een simpel number recognition voorbeeld om de basisprincipes van het trainen van een neuraal netwerk te begrijpen. Dit voorbeeld hielp ons om inzicht te krijgen in de verschillende stappen van het trainingsproces, zoals het voorbereiden van de data, het definiëren van de modelarchitectuur en het optimaliseren. Dit voorbeeld maakte gebruik van de MNIST dataset, een veelgebruikte dataset voor het trainen van neurale netwerken. Deze dataset bevat afbeeldingen van handgeschreven cijfers en is ideaal voor het leren van de basisprincipes van beeldherkenning met neurale netwerken. Door dit voorbeeld te bestuderen, konden we de concepten van input- en outputlagen, activatiefuncties en backpropagation beter begrijpen. Dit vormde een solide basis voor de latere ontwikkeling.

## Sprint 3

Tijdens deze sprint is er een simulatie gemaakt van de pingpongopstelling in Python. Deze simulatie was bedoeld om het gedrag van de pingpongbal te modelleren en om te begrijpen hoe de aansturing van de bal het beste kon worden gerealiseerd. We hebben hierbij gebruik gemaakt van de kennis die we in de vorige sprint hadden opgedaan over neurale netwerken en simulaties. Het doel van de simulatie is het maken van een dataset die gebruikt kan worden om het neuraal netwerk te trainen. De simulatie was gebaseerd op de fysische eigenschappen van de pingpongbal en de interactie met de omgeving, zoals luchtweerstand en zwaartekracht. Door verschillende scenario's te simuleren, konden we een breed scala aan data genereren die representatief was voor de verschillende situaties waarin de pingpongbal zich kon bevinden. Deze dataset werd vervolgens gebruikt om het neuraal netwerk te trainen, zodat het in staat zou zijn om het gedrag van de PID-regelaar na te bootsen.

Een van de uitdagingen in deze fase was het maken van een realistische simulatie die de pingpong simulatie zo nauwkeurig mogelijk nabootste en het integreren van een PID-regelaar in de simulatie. We hebben verschillende parameters moeten afstemmen, zoals de massa van de bal, zwaartekracht  en de tuning van de PID-regelaar om ervoor te zorgen dat de simulatie overeenkwam met de werkelijke pingpongopstelling. Hierdoor kan er een perfecte PID regelaar getraind worden. en was het mogelijk om een dataset te genereren die geschikt was voor het trainen van het neuraal netwerk. De simulatie is vooral geprogrammeerd in Python, waarbij we gebruik hebben gemaakt van bibliotheken zoals NumPy en Matplotlib voor de wiskundige berekeningen en visualisatie van de resultaten. Deze aanpak stelde ons in staat om snel iteraties uit te voeren en aanpassingen te maken op basis van de resultaten, wat cruciaal was voor het project. Hiermee is het mogelijk om snel een dataset te genereren die gebruikt kan worden voor het trainen van het neuraal netwerk. 

## Sprint 4

Tijdens deze sprint is er gewerkt aan de implementatie van het neuraal netwerk op de FRDM-MCXN947 microcontroller. Dit was een uitdagende fase, omdat we moesten zorgen dat het netwerk efficiënt genoeg was om op de beperkte hardware van de microcontroller te draaien. We hebben hiervoor gebruik gemaakt van TensorFlow Lite, een versie van TensorFlow die speciaal is ontworpen voor embedded systemen. Het doel was om het getrainde netwerk te optimaliseren en te converteren naar een formaat dat geschikt was voor de microcontroller. Om te bevestigen dat het importeren van een neuraal netwerk op de microcontroller goed ging, hebben we een eenvoudig neuraal netwerk geimplementeerd dat een sinusgolf kan voorspellen. Dit netwerk was veel eenvoudiger dan het uiteindelijke netwerk dat het gedrag van de PID-regelaar moest nabootsen, maar het diende als een proof of concept. We hebben de stappen doorlopen om het netwerk te converteren naar TensorFlow Lite formaat en dit op de microcontroller te laden. Deze fase was cruciaal om te begrijpen hoe we de complexiteit van het uiteindelijke netwerk konden reduceren zonder in te boeten op de prestaties.

## Sprint 5

In de laatste sprint is er gericht op de intergratie van het neuraal netwerk met de pingpongopstelling. Dit omvatte het testen van de communicatie tussen de microcontroller,hardware en het neuraal netwerk. In deze sprint zijn voor het trainen van het neuraal netwerk de data gebruikt die we in de vorige sprint hadden gegenereerd met de simulatie. We hebben het netwerk getraind om het gedrag van de PID-regelaar na te bootsen, zodat het in staat zou zijn om de pingpongbal op een gewenste hoogte te houden. Dit vereiste een zorgvuldige afstemming van de hyperparameters van het netwerk, zoals het aantal lagen, het aantal neuronen per laag en de leersnelheid. Na verschillende iteraties van training en evaluatie hebben we een netwerk ontwikkeld dat goed presteerde in het nabootsen van de PID-regelaar. 



